<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Task Organizer</title>
    <!-- Flatpickr for Date/Time Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2? family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-tasks"></i> Smart Task Organizer</h1>
        </div>
        
        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="totalTasks">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="completedTasks">0</div>
                <div class="stat-label">Ù…ÙƒØªÙ…Ù„Ø©</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="pendingTasks">0</div>
                <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div>
            </div>
        </div>
        
        <!-- Add Task Form -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <form id="taskForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label><i class="fas fa-heading"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                        <input type="text" class="form-control" id="title" required placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©... ">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-align-left"></i> Ø§Ù„ÙˆØµÙ</label>
                        <input type="text" class="form-control" id="description" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©...">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-calendar-alt"></i> Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</label>
                        <div class="datetime-wrapper">
                            <i class="fas fa-clock"></i>
                            <input type="text" class="form-control" id="deadline" required placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª... ">
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-flag"></i> Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select class="form-control" id="priority">
                            <option value="High">ğŸ”´ Ø¹Ø§Ù„ÙŠØ© - Ø¹Ø§Ø¬Ù„</option>
                            <option value="Medium" selected>ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© - Ù…Ù‡Ù…</option>
                            <option value="Low">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶Ø© - ÙŠÙ…ÙƒÙ† ØªØ£Ø¬ÙŠÙ„Ù‡</option>
                        </select>
                    </div>
                    <div class="form-group full-width" style="text-align: center; margin-top: 10px;">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©
                        </button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Task List -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-list-check"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
            <ul class="task-list" id="taskList">
                <!-- Tasks will be loaded here -->
            </ul>
        </div>
    </div>

    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>
    
    <script>
        const API_URL = 'http://127.0.0.1:5000';

        // Initialize Flatpickr Date/Time Picker
        flatpickr("#deadline", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            locale: "ar",
            time_24hr: true,
            minDate: "today",
            disableMobile: true,
            placeholder: "Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª.. .",
            theme: "material_blue"
        });

        // Load tasks on page load
        document.addEventListener('DOMContentLoaded', loadTasks);

        // Add task form submit
        document.getElementById('taskForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const task = {
                title: document.getElementById('title').value,
                description: document. getElementById('description').value,
                deadline: document.getElementById('deadline').value,
                priority: document. getElementById('priority').value
            };

            const response = await fetch(`${API_URL}/tasks`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(task)
            });

            if (response.ok) {
                document.getElementById('taskForm').reset();
                // Reset flatpickr
                document.getElementById('deadline')._flatpickr. clear();
                loadTasks();
                showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!  âœ…');
            }
        });

        async function loadTasks() {
            const response = await fetch(`${API_URL}/tasks`);
            const tasks = await response.json();
            
            // Update stats
            const completed = tasks.filter(t => t.status === 'Completed').length;
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('pendingTasks').textContent = tasks.length - completed;
            
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';

            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹<br>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©! </p>
                    </div>
                `;
                return;
            }

            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = `task-item ${task.status === 'Completed' ? 'completed' : ''}`;
                
                const priorityClass = `priority-${task. priority. toLowerCase()}`;
                const statusClass = task.status === 'Completed' ? 'status-completed' : 'status-todo';
                const statusText = task.status === 'Completed' ? 'Ù…ÙƒØªÙ…Ù„Ø©' :  'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°';
                
                const priorityText = {
                    'High': 'Ø¹Ø§Ù„ÙŠØ©',
                    'Medium': 'Ù…ØªÙˆØ³Ø·Ø©', 
                    'Low': 'Ù…Ù†Ø®ÙØ¶Ø©'
                };
                
                li.innerHTML = `
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description || 'Ø¨Ø¯ÙˆÙ† ÙˆØµÙ'}</div>
                        <div class="task-meta">
                            <span><i class="fas fa-calendar"></i> ${task.deadline}</span>
                            <span class="priority-badge ${priorityClass}">${priorityText[task.priority] || task.priority}</span>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        ${task.status !== 'Completed' ? 
                            `<button class="btn btn-success btn-icon" onclick="completeTask(${index})" title="Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©">
                                <i class="fas fa-check"></i>
                            </button>` : ''}
                        <button class="btn btn-danger btn-icon" onclick="deleteTask(${index})" title="Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                taskList.appendChild(li);
            });
        }

        async function completeTask(index) {
            await fetch(`${API_URL}/tasks/${index}/complete`);
            loadTasks();
            showNotification('ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©!  ğŸ‰');
        }

        async function deleteTask(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ')) {
                await fetch(`${API_URL}/tasks/${index}`, { method: 'DELETE' });
                loadTasks();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©!  ğŸ—‘ï¸');
            }
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification. style.cssText = `
                position: fixed;
                top:  20px;
                left: 50%;
                transform:  translateX(-50%);
                background:  linear-gradient(135deg, #00d9ff, #00ff88);
                color: #1a1a2e;
                padding:  15px 30px;
                border-radius: 10px;
                font-weight: 700;
                font-family: 'Tajawal', sans-serif;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;
            notification.textContent = message;
            document. body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>